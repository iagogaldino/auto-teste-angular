<div class="app-container">
  <!-- Header -->
  <mat-toolbar color="primary" class="app-header">
    <mat-toolbar-row>
      <div class="brand">
        <img src="/assets/logo.png" alt="Logo" class="app-logo" width="139" height="24" />
        <span class="app-title">DelsucTest</span>
      </div>
      <span class="spacer"></span>
      <button mat-icon-button (click)="openConfigModal()" title="Configura√ß√µes" color="primary">
        <mat-icon>settings</mat-icon>
      </button>
      <mat-chip-listbox>
        <mat-chip [color]="isConnected() ? 'accent' : 'warn'">
          {{ isConnected() ? 'Conectado' : 'Desconectado' }}
        </mat-chip>
      </mat-chip-listbox>
    </mat-toolbar-row>
  </mat-toolbar>

  <!-- Status Messages -->
  <div class="status-section">
    <mat-card *ngIf="errorMessage()" class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon color="warn">error</mat-icon>
          <span>{{ errorMessage() }}</span>
          <button mat-icon-button (click)="clearError()" class="clear-error">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <mat-horizontal-stepper [linear]="true" class="flow-stepper" [disableRipple]="true" #stepper="matStepper">

    
    <mat-step label="1. Escanear" [completed]="!!scanProgress() || scannedComponents().length > 0">
    <!-- Step 1: Directory Scan -->
    <mat-card class="step-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>folder</mat-icon>
          Escanear Diret√≥rio
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="input-group">
          <mat-form-field appearance="fill" class="directory-input">
            <mat-label>Caminho do diret√≥rio</mat-label>
            <input 
              matInput
              [(ngModel)]="directoryPath" 
              placeholder="ex: C:\\Users\\...\\src"
              [disabled]="isScanning()"
              (keydown.enter)="scanDirectory()"
            >
            <button 
              mat-icon-button 
              matSuffix
              color="primary"
              (click)="scanDirectory()" 
              [disabled]="isScanning() || !directoryPath().trim()"
              aria-label="Escanear diret√≥rio"
            >
              <mat-icon [class.spinning]="isScanning()">{{ isScanning() ? 'refresh' : 'search' }}</mat-icon>
            </button>
          </mat-form-field>
        </div>
        
        <!-- Scan Progress -->
        <div class="progress-section" *ngIf="scanProgress()">
          <mat-progress-bar 
            mode="determinate" 
            [value]="scanProgress()!.percentage"
            color="primary"
          ></mat-progress-bar>
          <div class="progress-text">
            {{ scanProgress()!.current }}/{{ scanProgress()!.total }} - {{ scanProgress()!.currentFile }}
          </div>
        </div>
        
        <!-- Scan Success Message -->
        <div class="scan-success" *ngIf="scanCompleted()">
          <div class="success-content">
            <mat-icon color="primary">check_circle</mat-icon>
            <span>{{ scannedComponents().length }} componentes encontrados!</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
    </mat-step>

    <mat-step label="2. Selecionar" [completed]="selectedFiles().length > 0">
    <!-- Step 2: Select Components -->
    <mat-expansion-panel *ngIf="scannedComponents().length > 0">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>description</mat-icon>
          Selecionar Componentes ({{ scannedComponents().length }} encontrados)
        </mat-panel-title>
        <mat-panel-description>
          <div class="step-actions">
            <button mat-raised-button (click)="selectAllFiles()" color="primary">
              <mat-icon>select_all</mat-icon>
              Todos
            </button>
            <button mat-raised-button (click)="clearSelection()" color="accent">
              <mat-icon>clear_all</mat-icon>
              Limpar
            </button>
            <button 
              mat-raised-button 
              color="primary" 
              (click)="stepper.next()" 
              [disabled]="selectedFiles().length === 0"
              title="Ir para 3. Gerar"
            >
              <mat-icon>arrow_forward</mat-icon>
              Ir para Gerar
            </button>
          </div>
        </mat-panel-description>
      </mat-expansion-panel-header>

        <div class="selection-info">
          <mat-chip color="primary">
            <mat-icon>check_circle</mat-icon>
            {{ selectedFiles().length }} selecionados
          </mat-chip>
        </div>
        
        <mat-table [dataSource]="scannedComponents()" class="components-table">
          <!-- Checkbox Column -->
          <ng-container matColumnDef="select">
            <mat-header-cell *matHeaderCellDef>
              <mat-checkbox 
                [checked]="selectedFiles().length === scannedComponents().length && scannedComponents().length > 0"
                [indeterminate]="selectedFiles().length > 0 && selectedFiles().length < scannedComponents().length"
                (change)="toggleAllFiles()"
              ></mat-checkbox>
            </mat-header-cell>
            <mat-cell *matCellDef="let component">
              <mat-checkbox 
                [checked]="selectedFiles().includes(component.filePath)"
                (change)="toggleFileSelection(component.filePath)"
              ></mat-checkbox>
            </mat-cell>
          </ng-container>

          <!-- Component Name Column -->
          <ng-container matColumnDef="component">
            <mat-header-cell *matHeaderCellDef>Componente</mat-header-cell>
            <mat-cell *matCellDef="let component">
              <strong>{{ component.name }}</strong>
            </mat-cell>
          </ng-container>

          <!-- File Path Column -->
          <ng-container matColumnDef="file">
            <mat-header-cell *matHeaderCellDef>Arquivo</mat-header-cell>
            <mat-cell *matCellDef="let component">
              <span class="path-text">{{ component.filePath }}</span>
            </mat-cell>
          </ng-container>

          

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <mat-header-cell *matHeaderCellDef>A√ß√µes</mat-header-cell>
            <mat-cell *matCellDef="let component">
              <button 
                mat-icon-button
                (click)="viewFileContent(component)" 
                title="Ver c√≥digo"
                color="primary"
              >
                <mat-icon>visibility</mat-icon>
              </button>
              <button 
                mat-icon-button
                (click)="generateTestForComponent(component)"
                [disabled]="isCreatingTest()"
                title="Gerar teste"
                color="accent"
              >
                <mat-icon>{{ isCreatingTest() ? 'hourglass_empty' : 'auto_awesome' }}</mat-icon>
              </button>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="['select', 'actions', 'component', 'file']"></mat-header-row>
          <mat-row 
            *matRowDef="let row; columns: ['select', 'actions', 'component', 'file'];"
            [class.selected]="selectedFiles().includes(row.filePath)"
          ></mat-row>
        </mat-table>
    </mat-expansion-panel>
    </mat-step>

    <mat-step label="3. Gerar" [completed]="!!testProgress() || testResults().length > 0">
    <!-- Step 3: Generate Tests -->
    <mat-card class="step-card" *ngIf="hasSelectedFiles()">
      <mat-card-header class="centered-header">
        <button 
          mat-raised-button
          color="primary"
          (click)="generateTests()" 
          [disabled]="!canGenerateTests()"
          class="generate-tests-btn"
        >
          <mat-icon>{{ isGeneratingTests() ? 'refresh' : 'rocket_launch' }}</mat-icon>
          {{ isGeneratingTests() ? 'Gerando...' : 'Gerar Testes' }}
        </button>
      </mat-card-header>

      <mat-card-content>
        <!-- Animated progress while starting generation -->
        <div class="progress-section" *ngIf="isGeneratingTests() && !testProgress()">
          <mat-progress-bar 
            mode="indeterminate"
            color="primary"
          ></mat-progress-bar>
        </div>

        <!-- Test Generation Progress -->
        <div class="progress-section" *ngIf="testProgress()">
          <mat-progress-bar 
            mode="determinate" 
            [value]="testProgress()!.percentage"
            color="primary"
          ></mat-progress-bar>
          <div class="progress-text">
            {{ testProgress()!.current }}/{{ testProgress()!.total }} - {{ testProgress()!.currentFile }}
          </div>
        </div>
        
        <!-- Test Generation Success Message -->
        <div class="scan-success" *ngIf="testsGenerated()">
          <div class="success-content">
            <mat-icon color="primary">check_circle</mat-icon>
            <span>{{ successCount() }} teste(s) gerado(s) com sucesso!</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
    <div class="no-data" *ngIf="!hasSelectedFiles()">Selecione ao menos um arquivo para gerar testes.</div>
    </mat-step>

    <mat-step label="4. Resultados" [completed]="testResults().length > 0">
    <!-- Step 4: Test Results -->
    <mat-expansion-panel *ngIf="testResults().length > 0">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>assessment</mat-icon>
          Resultados dos Testes ({{ testResults().length }})
        </mat-panel-title>
        <mat-panel-description>
          <div class="results-summary">
            <mat-chip color="primary">
              <mat-icon>check_circle</mat-icon>
              {{ successCount() }} Sucessos
            </mat-chip>
            <mat-chip color="warn" *ngIf="errorCount() > 0">
              <mat-icon>error</mat-icon>
              {{ errorCount() }} Erros
            </mat-chip>
          </div>
        </mat-panel-description>
      </mat-expansion-panel-header>

        <mat-table [dataSource]="testResults()" class="test-results-table">
          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
            <mat-cell *matCellDef="let result">
              <mat-chip [color]="result.success ? 'primary' : 'warn'">
                <mat-icon>{{ result.success ? 'check_circle' : 'error' }}</mat-icon>
                {{ result.success ? 'Sucesso' : 'Erro' }}
              </mat-chip>
            </mat-cell>
          </ng-container>

          <!-- File Column -->
          <ng-container matColumnDef="file">
            <mat-header-cell *matHeaderCellDef>Arquivo</mat-header-cell>
            <mat-cell *matCellDef="let result">
              <div class="file-info">
                <div class="file-name">{{ getFileName(result.filePath) }}</div>
                <div class="file-path">{{ result.filePath }}</div>
              </div>
            </mat-cell>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <mat-header-cell *matHeaderCellDef>A√ß√µes</mat-header-cell>
            <mat-cell *matCellDef="let result">
              <div class="action-buttons">
                <button 
                  mat-icon-button
                  (click)="copyTestCode(result.testCode)"
                  title="Copiar c√≥digo"
                  *ngIf="result.success"
                  color="primary"
                >
                  <mat-icon>content_copy</mat-icon>
                </button>
                <button 
                  mat-icon-button
                  (click)="createTestFile(result)"
                  [disabled]="isCreatingTest()"
                  title="Criar arquivo"
                  *ngIf="result.success"
                  color="accent"
                >
                  <mat-icon>{{ isCreatingTest() ? 'hourglass_empty' : 'save' }}</mat-icon>
                </button>
                <button 
                  mat-icon-button
                  (click)="executeTest(result)"
                  [disabled]="isExecutingTest() || !result.success"
                  title="Executar teste"
                  *ngIf="result.success"
                  color="primary"
                >
                  <mat-icon>{{ isExecutingTest() ? 'hourglass_empty' : 'play_arrow' }}</mat-icon>
                </button>
                <button 
                  mat-icon-button
                  (click)="retryTest(result)"
                  [disabled]="isGeneratingTests()"
                  title="Refazer teste"
                  *ngIf="!result.success"
                  color="warn"
                >
                  <mat-icon>{{ isGeneratingTests() ? 'hourglass_empty' : 'refresh' }}</mat-icon>
                </button>
                <button 
                  mat-icon-button
                  (click)="viewTestDetails(result)"
                  title="Ver detalhes"
                  color="primary"
                >
                  <mat-icon>visibility</mat-icon>
                </button>
              </div>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="['status', 'file', 'actions']"></mat-header-row>
          <mat-row *matRowDef="let row; columns: ['status', 'file', 'actions'];"></mat-row>
        </mat-table>
    </mat-expansion-panel>
    <div class="no-data" *ngIf="testResults().length === 0">Gere testes para visualizar os resultados.</div>
    </mat-step>

    <mat-step label="5. Executar" [completed]="allTestsExecution() && allTestsExecution()!.status !== 'running'">
    <!-- Step 5: Execute All Tests -->
    <mat-expansion-panel *ngIf="hasCreatedTests()">
      <mat-expansion-panel-header class="centered-panel-header">
        <mat-panel-title class="visually-hidden"></mat-panel-title>
        <mat-panel-description>
          <button 
            mat-raised-button
            color="accent"
            (click)="executeAllTests()" 
            [disabled]="isExecutingAllTests()"
            class="execute-all-tests-btn"
          >
            <mat-icon>{{ isExecutingAllTests() ? 'hourglass_empty' : 'play_arrow' }}</mat-icon>
            {{ isExecutingAllTests() ? 'Executando...' : 'Executar Todos' }}
          </button>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <!-- All Tests Execution Progress -->
      <div class="all-tests-execution" *ngIf="allTestsExecution()">
        <div 
          class="execution-output" 
          [ngClass]="getAllTestsExecutionStatusClass(allTestsExecution()!.status)"
          #allTestsOutputContainer
        >
          <pre class="output-content">{{ allTestsExecution()!.output }}</pre>
        </div>
      </div>
    </mat-expansion-panel>
    <div class="no-data" *ngIf="!hasCreatedTests()">Gere ao menos um teste antes de executar todos.</div>
    </mat-step>

    </mat-horizontal-stepper>
  </div>

  <!-- Modals -->
  <!-- File Content Modal -->
  <div class="file-content-modal" *ngIf="fileContent()" (click)="closeFileContentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <mat-icon>code</mat-icon>
          C√≥digo do Arquivo: {{ getFileName(currentFilePath()) }}
        </h3>
        <button mat-icon-button (click)="closeFileContentModal()" class="close-modal">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="modal-body">
        <div class="file-info-header">
          <mat-chip color="accent">
            <mat-icon>description</mat-icon>
            {{ currentFilePath() }}
          </mat-chip>
        </div>
        <div class="code-container">
          <pre><code>{{ fileContent() }}</code></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Test Details Modal -->
  <div class="test-details-modal" *ngIf="selectedTestResult()" (click)="closeTestDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Detalhes do Teste: {{ getFileName(selectedTestResult()!.filePath) }}</h3>
        <button mat-icon-button (click)="closeTestDetails()" class="close-modal">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="modal-body">
        <div class="test-details-content" *ngIf="selectedTestResult()!.success">
          <div class="explanation">
            <h4>üìù Explica√ß√£o:</h4>
            <p>{{ selectedTestResult()!.explanation }}</p>
          </div>

          <div class="test-cases" *ngIf="selectedTestResult()!.testCases.length > 0">
            <h4>üß™ Casos de Teste:</h4>
            <ul>
              <li *ngFor="let testCase of selectedTestResult()!.testCases">{{ testCase }}</li>
            </ul>
          </div>

          <div class="dependencies" *ngIf="selectedTestResult()!.dependencies.length > 0">
            <h4>üì¶ Depend√™ncias:</h4>
            <ul>
              <li *ngFor="let dep of selectedTestResult()!.dependencies">{{ dep }}</li>
            </ul>
          </div>

          <div class="test-code">
            <div class="test-code-header">
              <h4>üíª C√≥digo do Teste:</h4>
              <div class="test-code-actions">
                <button 
                  mat-raised-button
                  color="primary"
                  (click)="copyTestCode(selectedTestResult()!.testCode)"
                  title="Copiar c√≥digo"
                >
                  <mat-icon>content_copy</mat-icon>
                  Copiar
                </button>
                <button 
                  mat-raised-button
                  color="accent"
                  (click)="createTestFile(selectedTestResult()!)"
                  [disabled]="isCreatingTest()"
                  title="Criar arquivo de teste no projeto"
                >
                  <mat-icon>{{ isCreatingTest() ? 'hourglass_empty' : 'save' }}</mat-icon>
                  {{ isCreatingTest() ? 'Criando...' : 'Criar Teste' }}
                </button>
                <button 
                  mat-raised-button
                  color="primary"
                  (click)="executeTest(selectedTestResult()!)"
                  [disabled]="isExecutingTest() || !selectedTestResult()!.success"
                  title="Executar teste com Jest"
                >
                  <mat-icon>{{ isExecutingTest() ? 'hourglass_empty' : 'play_arrow' }}</mat-icon>
                  {{ isExecutingTest() ? 'Executando...' : 'Executar Teste' }}
                </button>
              </div>
            </div>
            <div class="code-container">
              <pre><code class="typescript">{{ formatTestCode(selectedTestResult()!.testCode) }}</code></pre>
            </div>
            
            <!-- Test Execution Section -->
            <div class="test-execution" *ngIf="selectedTestResult()!.testExecution">
              <div class="test-execution-header">
                <h4>üß™ Execu√ß√£o do Teste:</h4>
                <div class="execution-status">
                  <button 
                    *ngIf="selectedTestResult()!.testExecution!.status === 'error'"
                    mat-raised-button
                    color="warn"
                    (click)="regenerateTestFromExecutionError(selectedTestResult()!)"
                    [disabled]="isFixingTest() || fixingTestFile() === selectedTestResult()!.filePath"
                    title="Gerar novo teste corrigindo o erro de execu√ß√£o"
                    class="regenerate-button"
                  >
                    <mat-icon>{{ isFixingTest() && fixingTestFile() === selectedTestResult()!.filePath ? 'hourglass_empty' : 'autorenew' }}</mat-icon>
                    {{ isFixingTest() && fixingTestFile() === selectedTestResult()!.filePath ? 'Corrigindo...' : 'Corrigir com IA' }}
                  </button>
                  <span class="status-badge" [class]="getExecutionStatusClass(selectedTestResult()!.testExecution!.status)">
                    {{ getExecutionStatusText(selectedTestResult()!.testExecution!.status) }}
                  </span>
                </div>
              </div>
              <div class="execution-output">
                <pre class="output-content">{{ selectedTestResult()!.testExecution!.output }}</pre>
              </div>
            </div>
          </div>
        </div>

        <div class="result-error" *ngIf="!selectedTestResult()!.success">
          <div class="error-content">
            <div class="error-header">
              <mat-icon color="warn">error</mat-icon>
              <h4>Detalhes do Erro</h4>
            </div>
            <div class="error-message-box">
              <div class="error-label">Arquivo:</div>
              <div class="error-value">{{ selectedTestResult()!.filePath }}</div>
            </div>
            <div class="error-message-box" *ngIf="selectedTestResult()!.timestamp">
              <div class="error-label">Data/Hora:</div>
              <div class="error-value">{{ selectedTestResult()!.timestamp | date:'dd/MM/yyyy HH:mm:ss' }}</div>
            </div>
            <div class="error-message-box">
              <div class="error-label">Mensagem de Erro:</div>
              <div class="error-text">{{ formatErrorMessage(selectedTestResult()!.error) }}</div>
            </div>
            <div class="error-actions">
              <button 
                mat-raised-button
                color="warn"
                (click)="retryTest(selectedTestResult()!)"
                [disabled]="isGeneratingTests()"
                title="Refazer teste"
              >
                <mat-icon>{{ isGeneratingTests() ? 'hourglass_empty' : 'refresh' }}</mat-icon>
                {{ isGeneratingTests() ? 'Refazendo...' : 'Refazer Teste' }}
              </button>
              <button 
                mat-raised-button
                color="accent"
                (click)="fixTestError(selectedTestResult()!)"
                [disabled]="isFixingTest() || fixingTestFile() === selectedTestResult()!.filePath"
                title="Melhorar teste com IA"
              >
                <mat-icon>{{ isFixingTest() && fixingTestFile() === selectedTestResult()!.filePath ? 'hourglass_empty' : 'build' }}</mat-icon>
                {{ isFixingTest() && fixingTestFile() === selectedTestResult()!.filePath ? 'Melhorando...' : 'Melhorar com IA' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Custom Prompt Modal -->
  <div class="custom-prompt-modal" *ngIf="showCustomPromptDialog()" (click)="closeCustomPromptDialog()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>üîß Melhorar Teste com IA</h3>
        <button mat-icon-button (click)="closeCustomPromptDialog()" class="close-modal">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="modal-body">
        <div class="test-info" *ngIf="selectedTestForPrompt()">
          <div class="test-header">
            <h4>{{ getFileName(selectedTestForPrompt()!.filePath) }}</h4>
            <span class="test-status" [class]="selectedTestForPrompt()!.success ? 'success' : 'error'">
              {{ selectedTestForPrompt()!.success ? '‚úÖ Sucesso' : '‚ùå Erro' }}
            </span>
          </div>
          
          <div class="error-section" *ngIf="!selectedTestForPrompt()!.success">
            <h5>üêõ Erro Encontrado:</h5>
            <div class="error-message">
              {{ selectedTestForPrompt()!.error }}
            </div>
          </div>

          <div class="test-code-preview">
            <h5>üìù C√≥digo do Teste Atual:</h5>
            <div class="code-preview">
              <pre><code class="typescript">{{ selectedTestForPrompt()!.testCode }}</code></pre>
            </div>
          </div>
        </div>

        <div class="prompt-section">
          <h5>üí¨ Instru√ß√µes para a IA:</h5>
          <p class="prompt-description">
            Descreva o que voc√™ gostaria que a IA fa√ßa com este teste. Seja espec√≠fico sobre as melhorias desejadas.
          </p>
          <textarea 
            [(ngModel)]="customPrompt"
            class="prompt-textarea"
            placeholder="Ex: Adicione mais casos de teste para edge cases, melhore a cobertura de c√≥digo, corrija os mocks, etc..."
            rows="6"
            (keydown.enter)="$event.preventDefault(); $event.stopPropagation(); processCustomPrompt()"
          ></textarea>
        </div>

        <div class="modal-actions">
          <button 
            mat-raised-button
            color="warn"
            (click)="closeCustomPromptDialog()"
          >
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
          <button 
            mat-raised-button
            color="primary"
            (click)="processCustomPrompt()"
            [disabled]="!customPrompt().trim() || isFixingTest()"
          >
            <mat-icon>{{ isFixingTest() ? 'hourglass_empty' : 'rocket_launch' }}</mat-icon>
            {{ isFixingTest() ? 'Processando...' : 'Processar com IA' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Configuration Modal -->
  <div class="config-modal" *ngIf="showConfigModal()" (click)="closeConfigModal()">
    <div class="modal-content config-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <mat-icon>settings</mat-icon>
          Configura√ß√£o do Sistema
        </h3>
        <button mat-icon-button (click)="closeConfigModal()" class="close-modal">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="modal-body">
        <mat-tab-group>
          <!-- Tab 1: Configura√ß√µes Gerais -->
          <mat-tab label="Geral">
            <div class="config-form">
              <mat-form-field appearance="fill">
                <mat-label>Ambiente</mat-label>
                <select matNativeControl [ngModel]="configNodeEnv()" (ngModelChange)="configNodeEnv.set($event)">
                  <option value="development">Development</option>
                  <option value="production">Production</option>
                </select>
              </mat-form-field>

              <mat-form-field appearance="fill">
                <mat-label>Porta do Servidor</mat-label>
                <input matInput type="number" [ngModel]="configPort()" (ngModelChange)="configPort.set(+$event)">
              </mat-form-field>

              <mat-form-field appearance="fill">
                <mat-label>CORS Origin</mat-label>
                <input matInput [ngModel]="configCorsOrigin()" (ngModelChange)="configCorsOrigin.set($event)">
              </mat-form-field>

              <mat-form-field appearance="fill">
                <mat-label>N√≠vel de Log</mat-label>
                <select matNativeControl [ngModel]="configLogLevel()" (ngModelChange)="configLogLevel.set($event)">
                  <option value="debug">Debug</option>
                  <option value="info">Info</option>
                  <option value="warn">Warn</option>
                  <option value="error">Error</option>
                </select>
              </mat-form-field>
            </div>
          </mat-tab>

          <!-- Tab 2: Provedor de IA -->
          <mat-tab label="Provedor de IA">
            <div class="config-form">
              <mat-form-field appearance="fill">
                <mat-label>Provedor</mat-label>
                <select matNativeControl [ngModel]="configAiProvider()" (ngModelChange)="configAiProvider.set($event)">
                  <option value="openai">OpenAI</option>
                  <option value="stackspot">StackSpot</option>
                </select>
              </mat-form-field>

              <mat-form-field appearance="fill" *ngIf="configAiProvider() === 'openai'">
                <mat-label>OpenAI API Key</mat-label>
                <input matInput type="password" [ngModel]="configOpenaiKey()" (ngModelChange)="configOpenaiKey.set($event)">
                <mat-hint>Chave da API OpenAI</mat-hint>
              </mat-form-field>

              <div *ngIf="configAiProvider() === 'stackspot'" class="stackspot-config">
                <h4>Configura√ß√µes StackSpot</h4>
                <mat-form-field appearance="fill">
                  <mat-label>Client ID</mat-label>
                  <input matInput type="password" [ngModel]="configStackspotClientId()" (ngModelChange)="configStackspotClientId.set($event)">
                </mat-form-field>

                <mat-form-field appearance="fill">
                  <mat-label>Client Key</mat-label>
                  <input matInput type="password" [ngModel]="configStackspotClientKey()" (ngModelChange)="configStackspotClientKey.set($event)">
                </mat-form-field>

                <mat-form-field appearance="fill">
                  <mat-label>Realm</mat-label>
                  <input matInput [ngModel]="configStackspotRealm()" (ngModelChange)="configStackspotRealm.set($event)" placeholder="stackspot-freemium">
                </mat-form-field>

                <mat-form-field appearance="fill">
                  <mat-label>Token URL</mat-label>
                  <input matInput [ngModel]="configStackspotTokenUrl()" (ngModelChange)="configStackspotTokenUrl.set($event)">
                </mat-form-field>

                <mat-form-field appearance="fill">
                  <mat-label>Completions URL</mat-label>
                  <input matInput [ngModel]="configStackspotCompletionsUrl()" (ngModelChange)="configStackspotCompletionsUrl.set($event)">
                </mat-form-field>

                <mat-form-field appearance="fill">
                  <mat-label>Agent Chat URL</mat-label>
                  <input matInput [ngModel]="configStackspotAgentChatUrl()" (ngModelChange)="configStackspotAgentChatUrl.set($event)">
                </mat-form-field>
              </div>
            </div>
          </mat-tab>

          <!-- Tab 3: Avan√ßado -->
          <mat-tab label="Avan√ßado">
            <div class="config-form">
              <mat-form-field appearance="fill">
                <mat-label>Database URL</mat-label>
                <input matInput [ngModel]="configDatabaseUrl()" (ngModelChange)="configDatabaseUrl.set($event)">
              </mat-form-field>

              <mat-form-field appearance="fill">
                <mat-label>JWT Secret</mat-label>
                <input matInput type="password" [ngModel]="configJwtSecret()" (ngModelChange)="configJwtSecret.set($event)">
              </mat-form-field>

              <mat-form-field appearance="fill">
                <mat-label>User Agent</mat-label>
                <input matInput [ngModel]="configUserAgent()" (ngModelChange)="configUserAgent.set($event)">
              </mat-form-field>
            </div>
          </mat-tab>
        </mat-tab-group>

        <div class="config-info">
          <mat-icon color="primary">info</mat-icon>
          <span>As configura√ß√µes s√£o aplicadas automaticamente ap√≥s salvar. N√£o √© necess√°rio reiniciar o servidor.</span>
        </div>

        <!-- Feedback de salvamento -->
        <div class="config-save-feedback" *ngIf="configSaveMessage()">
          <div [class]="configSaveSuccess() ? 'save-success' : 'save-error'">
            <mat-icon>{{ configSaveSuccess() ? 'check_circle' : 'error' }}</mat-icon>
            <span>{{ configSaveMessage() }}</span>
          </div>
        </div>

        <div class="modal-actions">
          <button mat-raised-button color="warn" (click)="closeConfigModal()">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
          <button mat-raised-button color="primary" (click)="saveConfig()" [disabled]="isSavingConfig()">
            <mat-icon>{{ isSavingConfig() ? 'hourglass_empty' : 'save' }}</mat-icon>
            {{ isSavingConfig() ? 'Salvando...' : 'Salvar Configura√ß√£o' }}
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer class="app-footer">
    <div class="footer-content">
      <span>Desenvolvido por <strong>iago_galdino@hotmail.com</strong></span>
    </div>
  </footer>
</div>